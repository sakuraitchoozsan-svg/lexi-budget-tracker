<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"
  />
  <title>Lexi‚Äôs Budget Tracker üêæ</title>

  <!-- Tailwind + Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

  <!-- Modern sans font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink-50:#fff5f8;
      --pink-100:#ffe9f1;
      --pink-200:#ffd3e4;
      --pink-300:#ffb7d2;
      --pink-400:#ff9ac1;
      --pink-500:#ff7ab0;
      --ink:#2c2c35;
      --muted:#6b6b7a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--ink);
      background:linear-gradient(180deg, var(--pink-50), #fff);
    }
    /* Cards */
    .card{background:#fff;border:1px solid var(--pink-200); border-radius:1rem; padding:1rem; box-shadow:0 6px 24px rgba(255,122,176,.12)}
    .chip{background:var(--pink-100); border:1px solid var(--pink-300); border-radius:9999px; padding:.25rem .6rem;}
    /* Tabs */
    .tab-active{background:var(--pink-300) !important; color:#432;}
    /* Simple modal */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.35); z-index:50}
    .modal.active{display:flex}
    .modal-card{background:#fff; border:1px solid var(--pink-300); border-radius:1rem; width:min(720px, 92vw); padding:1rem}
    /* 3D kitten float */
    .kitten{position:absolute; width:70px; filter: drop-shadow(0 6px 10px rgba(255,122,176,.35)); animation:float 8s ease-in-out infinite}
    .kitten.k2{animation-duration:10s; top:12%; left:5%}
    .kitten.k1{top:8%; right:6%}
    @keyframes float{
      0%,100% { transform: translate3d(0,0,0) rotate(-2deg); }
      50% { transform: translate3d(0,-16px,0) rotate(2deg); }
    }
    /* Paw particles */
    .paw{
      position:fixed; pointer-events:none; z-index:60; opacity:.9; transform:translate(-50%,-50%);
      animation: pop 900ms ease forwards;
    }
    @keyframes pop{
      0%{transform:translate(-50%,-50%) scale(.6); opacity:0}
      15%{opacity:1}
      100%{transform:translate(-50%,-120%) scale(1.25) rotate(-10deg); opacity:0}
    }
    /* Pulse marker (due soon) */
    .pulse{ position:relative;}
    .pulse::after{
      content:""; position:absolute; inset:-3px; border-radius:14px; border:2px solid var(--pink-400);
      animation: pulseA 1.4s ease infinite;
    }
    @keyframes pulseA{0%{opacity:.3; transform:scale(.98)} 50%{opacity:1; transform:scale(1)} 100%{opacity:.3; transform:scale(.98)}}

    /* Buttons */
    .btn{border:1px solid var(--pink-300); background:#fff; padding:.45rem .85rem; border-radius:9999px}
    .btn-primary{background:var(--pink-300)}
    .grid-auto-200{display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:1rem}
    .grid-auto-260{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:1rem}
  </style>
</head>

<body class="min-h-screen">
  <!-- Floating kittens -->
  <img class="kitten k1" alt="kitten" src="data:image/svg+xml;utf8,<?xml version='1.0' ?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><circle cx='64' cy='64' r='58' fill='%23ffe9f1'/><path d='M32 50c-6 24 12 42 32 42s38-18 32-42-16-28-32-28-26 4-32 28z' fill='%23ffb7d2' stroke='%23ff7ab0' stroke-width='3'/><circle cx='52' cy='65' r='5' fill='%232c2c35'/><circle cx='76' cy='65' r='5' fill='%232c2c35'/><path d='M48 83c10 6 22 6 32 0' stroke='%232c2c35' stroke-width='3' fill='none'/></svg>"/>
  <img class="kitten k2" alt="kitten" src="data:image/svg+xml;utf8,<?xml version='1.0' ?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><rect x='8' y='8' width='112' height='112' rx='24' fill='%23ffd3e4'/><path d='M34 76c6 18 24 24 42 20s28-22 22-40-20-22-36-18-34 20-28 38z' fill='%23ff9ac1'/><circle cx='58' cy='73' r='5' fill='%232c2c35'/><circle cx='80' cy='73' r='5' fill='%232c2c35'/><path d='M56 88c8 5 16 5 24 0' stroke='%232c2c35' stroke-width='3' fill='none'/></svg>"/>

  <!-- Audio (precache path) -->
  <audio id="chime" src="/assets/kitten-chime.mp3" preload="auto"></audio>

  <!-- Top header: Clock / Weather / Holiday / Quote -->
  <header class="sticky top-0 z-40 backdrop-blur bg-[rgba(255,245,248,.85)] border-b border-[var(--pink-200)]">
    <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div class="text-sm">
          <div id="clock" class="font-semibold">--:-- -- ‚Ä¢ Mon, Jan 1</div>
          <div id="holiday" class="text-[12px] text-[var(--muted)]">Holiday: --</div>
        </div>
        <div id="weather" class="text-sm chip">Davao Weather: --</div>
      </div>
      <div id="quote" class="text-sm md:text-base italic text-[var(--muted)]"></div>
    </div>
  </header>

  <!-- App Title + Tabs -->
  <div class="max-w-6xl mx-auto px-4 mt-4">
    <div class="flex flex-wrap gap-2 items-center justify-between">
      <h1 class="text-2xl md:text-3xl font-bold">Lexi‚Äôs Budget Tracker üêæ</h1>
      <nav class="flex flex-wrap gap-2">
        <button class="btn tab-btn tab-active" data-panel="panel-dashboard">A) Dashboard</button>
        <button class="btn tab-btn" data-panel="panel-quick">B) Quick Setup</button>
        <button class="btn tab-btn" data-panel="panel-transactions">C) Income & Expenses</button>
        <button class="btn tab-btn" data-panel="panel-budgets">D) Monthly Budget</button>
        <button class="btn tab-btn" data-panel="panel-savings">E) Savings & Goals</button>
        <button class="btn tab-btn" data-panel="panel-salary">F) Live Salary Tracker</button>
        <button class="btn tab-btn" data-panel="panel-calendar">G) Calendar & Reminders</button>
        <button class="btn tab-btn" data-panel="panel-reports">Reports</button>
        <button class="btn tab-btn" data-panel="panel-settings">Settings</button>
      </nav>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 py-6 space-y-10">
    <!-- A) Dashboard -->
    <section id="panel-dashboard">
      <!-- Profile Info (editable) -->
      <div class="grid md:grid-cols-3 gap-4">
        <div class="card">
          <div class="font-semibold mb-2">Profile Info</div>
          <div class="grid gap-2">
            <label class="text-sm">Name <input id="profile-name" class="w-full border rounded-lg px-3 py-2" value="Lexi Natividad Tamot"/></label>
            <label class="text-sm">Phone <input id="profile-phone" class="w-full border rounded-lg px-3 py-2" value="09619128418"/></label>
            <label class="text-sm">Email <input id="profile-email" class="w-full border rounded-lg px-3 py-2" value="tamotnicko1999@gmail.com"/></label>
            <div class="flex gap-2">
              <button id="profile-save-btn" class="btn btn-primary">Save</button>
              <button id="profile-cancel-btn" class="btn">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Summary Cards -->
        <div class="md:col-span-2 grid-auto-260">
          <div class="card"><div class="text-sm">Running Pay Period Income</div><div id="pp-income" class="text-2xl font-bold">‚Ç±0</div></div>
          <div class="card"><div class="text-sm">Running Monthly Income</div><div id="mo-income" class="text-2xl font-bold">‚Ç±0</div></div>
          <div class="card"><div class="text-sm">Total Expenses</div><div id="total-expenses" class="text-2xl font-bold">‚Ç±0</div></div>
          <div class="card"><div class="text-sm">Balance</div><div id="balance" class="text-2xl font-bold">‚Ç±0</div></div>
          <div class="card"><div class="text-sm">Savings Rate</div><div id="savings-rate" class="text-2xl font-bold">0%</div></div>
          <div class="card"><div class="text-sm">Total Savings</div><div id="total-savings" class="text-2xl font-bold">‚Ç±0</div></div>
        </div>
      </div>

      <!-- Pay Period Summary -->
      <div class="grid md:grid-cols-2 gap-4">
        <div class="card">
          <div class="font-semibold mb-2">Pay Period Summary ‚Äî Previous</div>
          <div id="pp-prev" class="text-sm">Dates: -- ‚Ä¢ Expected: ‚Ç±0 ‚Ä¢ Actual: ‚Ç±0 ‚Ä¢ Diff: ‚Ç±0</div>
        </div>
        <div class="card">
          <div class="font-semibold mb-2">Pay Period Summary ‚Äî Current</div>
          <div id="pp-curr" class="text-sm">Dates: -- ‚Ä¢ Expected: ‚Ç±0 ‚Ä¢ Ongoing Actual: ‚Ç±0</div>
        </div>
      </div>

      <!-- Next bills / paychecks / recent transactions -->
      <div class="grid md:grid-cols-3 gap-4">
        <div class="card">
          <div class="font-semibold mb-2">Next Bills</div>
          <ul id="next-bills" class="space-y-2 text-sm"></ul>
        </div>
        <div class="card">
          <div class="font-semibold mb-2">Upcoming Paychecks</div>
          <ul id="upcoming-paychecks" class="space-y-2 text-sm"></ul>
        </div>
        <div class="card">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Recent Transactions</div>
            <button id="history-open-btn" class="btn">History</button>
          </div>
          <ul id="recent-tx" class="space-y-2 text-sm mt-2"></ul>
        </div>
      </div>

      <!-- Charts + Aggregation Toggle -->
      <div class="card">
        <div class="flex flex-wrap items-center gap-2 justify-between">
          <div class="font-semibold">Trends</div>
          <div class="flex gap-2">
            <button id="agg-biweekly" class="btn btn-primary">Bi-weekly</button>
            <button id="agg-monthly" class="btn">Monthly</button>
            <button id="agg-yearly" class="btn">Yearly</button>
          </div>
        </div>
        <div class="grid md:grid-cols-3 gap-4 mt-3">
          <canvas id="chart-income" height="140"></canvas>
          <canvas id="chart-expenses" height="140"></canvas>
          <canvas id="chart-savings" height="140"></canvas>
        </div>
      </div>
    </section>

    <!-- B) Quick Setup -->
    <section id="panel-quick" class="hidden">
      <div class="grid md:grid-cols-2 gap-6">
        <div class="card">
          <div class="font-semibold mb-2">Jobs</div>
          <form id="job-form" class="grid md:grid-cols-2 gap-2">
            <input id="job-company" class="border rounded-lg px-3 py-2" placeholder="Company" required/>
            <input id="job-salary" type="number" class="border rounded-lg px-3 py-2" placeholder="Monthly Salary (‚Ç±)" min="0" required/>
            <select id="job-cycle" class="border rounded-lg px-3 py-2">
              <option>weekly</option><option selected>bi-weekly</option><option>monthly</option>
            </select>
            <input id="job-shift" class="border rounded-lg px-3 py-2" placeholder="Shift schedule (e.g., M-F 9-6)"/>
            <div class="col-span-2 flex gap-2">
              <button id="job-save-btn" class="btn btn-primary">Save</button>
              <button id="job-cancel-btn" type="button" class="btn">Cancel</button>
            </div>
          </form>
          <ul id="job-list" class="mt-3 space-y-2"></ul>
        </div>

        <div class="card">
          <div class="font-semibold mb-2">Bills (Recurring)</div>
          <form id="bill-form" class="grid md:grid-cols-2 gap-2">
            <input id="bill-name" class="border rounded-lg px-3 py-2" placeholder="Bill name" required/>
            <input id="bill-amount" type="number" class="border rounded-lg px-3 py-2" placeholder="Amount (‚Ç±)" min="0" required/>
            <input id="bill-due" type="number" class="border rounded-lg px-3 py-2" placeholder="Due day (1-31)" min="1" max="31" required/>
            <label class="flex items-center gap-2 text-sm"><input id="bill-auto" type="checkbox"/> Auto-add</label>
            <div class="col-span-2 flex gap-2">
              <button id="bill-save-btn" class="btn btn-primary">Save</button>
              <button id="bill-cancel-btn" type="button" class="btn">Cancel</button>
            </div>
          </form>
          <ul id="bill-list" class="mt-3 space-y-2"></ul>
        </div>
      </div>

      <div class="card mt-6">
        <div class="font-semibold mb-2">Quick Summary</div>
        <div id="quick-summary" class="grid-auto-200"></div>
      </div>
    </section>

    <!-- C) Transactions -->
    <section id="panel-transactions" class="hidden">
      <div class="card">
        <div class="flex flex-wrap items-end gap-2">
          <div class="grid">
            <label class="text-xs">Search</label>
            <input id="tx-search" class="border rounded-lg px-3 py-2" placeholder="Description / notes / tags"/>
          </div>
          <div class="grid">
            <label class="text-xs">Start</label>
            <input id="tx-start" type="date" class="border rounded-lg px-3 py-2"/>
          </div>
          <div class="grid">
            <label class="text-xs">End</label>
            <input id="tx-end" type="date" class="border rounded-lg px-3 py-2"/>
          </div>
          <div class="grid">
            <label class="text-xs">Category</label>
            <select id="tx-category-filter" class="border rounded-lg px-3 py-2">
              <option value="">All</option>
              <option>income</option><option>expense</option><option>savings</option>
            </select>
          </div>
          <div class="grid">
            <label class="text-xs">Tags</label>
            <input id="tx-tags-filter" class="border rounded-lg px-3 py-2" placeholder="e.g. food, rent"/>
          </div>
          <div class="flex-1"></div>
          <button id="tx-add-btn" class="btn btn-primary">Add Transaction</button>
        </div>
        <div class="overflow-x-auto mt-3">
          <table class="w-full text-sm">
            <thead><tr class="text-left">
              <th class="p-2">Date</th><th class="p-2">Description</th><th class="p-2">Category</th>
              <th class="p-2">Amount</th><th class="p-2">Balance After</th><th class="p-2">Linked Job/Bill</th>
              <th class="p-2">Notes</th><th class="p-2">Tags</th><th class="p-2">Status</th><th class="p-2 text-right">Actions</th>
            </tr></thead>
            <tbody id="tx-tbody"></tbody>
          </table>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          <button id="export-json-btn" class="btn">Export JSON</button>
          <button id="export-csv-btn" class="btn">Export CSV</button>
          <button id="import-json-btn" class="btn">Import JSON</button>
          <button id="backup-btn" class="btn">Encrypted Backup</button>
          <button id="restore-btn" class="btn">Restore Backup</button>
          <button id="clear-data-btn" class="btn">Clear All</button>
        </div>
      </div>
    </section>

    <!-- D) Monthly Budget -->
    <section id="panel-budgets" class="hidden">
      <div class="card">
        <div class="flex items-center justify-between">
          <div class="font-semibold">Monthly Budget</div>
          <button id="budget-add-row-btn" class="btn btn-primary">Add Budget Row</button>
        </div>
        <div class="overflow-x-auto mt-3">
          <table class="w-full text-sm">
            <thead><tr class="text-left">
              <th class="p-2">Category</th><th class="p-2">Planned</th><th class="p-2">Actual</th><th class="p-2">Difference</th><th class="p-2">Linked Paycheck</th><th class="p-2 text-right">Actions</th>
            </tr></thead>
            <tbody id="budget-tbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- E) Savings & Goals -->
    <section id="panel-savings" class="hidden">
      <div class="grid md:grid-cols-2 gap-4">
        <div class="card">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Savings & Goals</div>
            <button id="goal-add-btn" class="btn btn-primary">Add Goal</button>
          </div>
          <div class="overflow-x-auto mt-3">
            <table class="w-full text-sm">
              <thead><tr class="text-left">
                <th class="p-2">Name</th><th class="p-2">Target</th><th class="p-2">Current</th><th class="p-2">Target Date</th><th class="p-2">Recurring</th><th class="p-2 text-right">Actions</th>
              </tr></thead>
              <tbody id="goal-tbody"></tbody>
            </table>
          </div>
        </div>
        <div class="card">
          <div class="grid gap-4">
            <canvas id="savings-trend" height="160"></canvas>
            <canvas id="goals-progress" height="160"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- F) Live Salary Tracker -->
    <section id="panel-salary" class="hidden">
      <div class="grid md:grid-cols-3 gap-4">
        <div class="card md:col-span-2">
          <div class="font-semibold mb-2">WorkDayRecord</div>
          <form id="workday-form" class="grid md:grid-cols-6 gap-2">
            <input id="wd-date" type="date" class="border rounded-lg px-3 py-2" required/>
            <input id="wd-job" class="border rounded-lg px-3 py-2" placeholder="Job (company)" required/>
            <input id="wd-hours" type="number" min="0" step="0.25" class="border rounded-lg px-3 py-2" placeholder="Hours" required/>
            <input id="wd-ot" type="number" min="0" step="0.25" class="border rounded-lg px-3 py-2" placeholder="OT"/>
            <input id="wd-deduct" type="number" min="0" step="0.01" class="border rounded-lg px-3 py-2" placeholder="Deductions"/>
            <div class="col-span-6 flex gap-2">
              <button id="workday-save-btn" class="btn btn-primary">Save</button>
              <button id="workday-cancel-btn" type="reset" class="btn">Cancel</button>
            </div>
          </form>
          <ul id="workday-list" class="mt-3 space-y-2"></ul>
        </div>
        <div class="card">
          <div class="font-semibold mb-2">Dual Paystub Preview</div>
          <div class="text-xs opacity-70 mb-2">Pay period (bi-weekly cutoff): 1‚Äì15 ‚Üí paid end of month ‚Ä¢ 16‚Äìend ‚Üí paid on 15th next month</div>
          <div id="stub-prev" class="text-sm chip mb-2">--</div>
          <div id="stub-curr" class="text-sm chip mb-2">--</div>
          <div id="paycheck-expected" class="font-semibold">Expected: ‚Ç±0</div>
          <div id="paycheck-actual" class="text-sm opacity-70">Actual: ‚Ç±0</div>
          <div class="mt-3 flex gap-2">
            <button id="paycheck-compute-btn" class="btn">Compute</button>
            <button id="paycheck-sync-btn" class="btn btn-primary">Sync paycheck ‚Üí Dashboard & Log</button>
          </div>
        </div>
      </div>
    </section>

    <!-- G) Calendar & Reminders -->
    <section id="panel-calendar" class="hidden">
      <div class="card">
        <div class="font-semibold mb-2">Month view (dd/mm/yyyy)</div>
        <div id="calendar" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-2"></div>
        <div class="mt-3">
          <button id="event-add-btn" class="btn btn-primary">Add Event</button>
        </div>
      </div>
    </section>

    <!-- Reports -->
    <section id="panel-reports" class="hidden">
      <div class="card">
        <div class="flex flex-wrap items-center gap-2 justify-between">
          <div class="font-semibold">Reports & Analytics</div>
          <div class="flex gap-2">
            <button id="rep-biweekly" class="btn btn-primary">Bi-weekly</button>
            <button id="rep-monthly" class="btn">Monthly</button>
            <button id="rep-yearly" class="btn">Yearly</button>
          </div>
        </div>
        <div class="grid md:grid-cols-3 gap-4 mt-3">
          <canvas id="rep-income" height="160"></canvas>
          <canvas id="rep-expenses" height="160"></canvas>
          <canvas id="rep-savings" height="160"></canvas>
        </div>
      </div>
    </section>

    <!-- Settings -->
    <section id="panel-settings" class="hidden">
      <div class="card">
        <div class="font-semibold mb-2">Settings</div>
        <div class="grid md:grid-cols-3 gap-3">
          <label class="text-sm">Average workdays/month
            <input id="avg-workdays" class="border rounded-lg px-3 py-2" type="number" min="15" max="26" value="22"/>
          </label>
          <div class="md:col-span-2 text-sm opacity-70">Currency defaults to ‚Ç± Philippine Peso. Timezone Asia/Manila.</div>
        </div>
        <div class="mt-3 flex gap-2">
          <button id="settings-save-btn" class="btn btn-primary">Save</button>
          <button id="settings-cancel-btn" class="btn">Cancel</button>
        </div>
      </div>
    </section>
  </main>

  <!-- History Modal (Recent / Income / Savings / Expenses / Previous Pay / Current Pay) -->
  <div id="history-modal" class="modal">
    <div class="modal-card">
      <div class="flex items-center justify-between mb-2">
        <div class="font-semibold">History</div>
        <button id="history-close-btn" class="btn">Close</button>
      </div>
      <div class="flex flex-wrap gap-2 mb-2">
        <button class="btn hist-tab btn-primary" data-hist="recent" aria-selected="true">Recent</button>
        <button class="btn hist-tab" data-hist="income">Income</button>
        <button class="btn hist-tab" data-hist="savings">Savings</button>
        <button class="btn hist-tab" data-hist="expenses">Expenses</button>
        <button class="btn hist-tab" data-hist="prevpay">Previous Pay</button>
        <button class="btn hist-tab" data-hist="currpay">Current Pay</button>
      </div>
      <div class="grid gap-2">
        <div id="hist-recent"></div>
        <div id="hist-income" class="hidden"></div>
        <div id="hist-savings" class="hidden"></div>
        <div id="hist-expenses" class="hidden"></div>
        <div id="hist-prevpay" class="hidden"></div>
        <div id="hist-currpay" class="hidden"></div>
      </div>
    </div>
  </div>

  <!-- Transaction Modal -->
  <div id="tx-modal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="flex items-center justify-between mb-2">
        <div class="font-semibold">Add / Edit Transaction</div>
        <button id="tx-cancel-btn" class="btn" type="button">Cancel</button>
      </div>
      <form id="tx-form" class="grid md:grid-cols-2 gap-2">
        <label class="text-sm">Date <input id="tx-date" type="date" class="border rounded-lg px-3 py-2" required/></label>
        <label class="text-sm">Description <input id="tx-desc" class="border rounded-lg px-3 py-2" placeholder="e.g., Groceries" required/></label>
        <label class="text-sm">Category
          <select id="tx-category" class="border rounded-lg px-3 py-2">
            <option>income</option><option>expense</option><option>savings</option>
          </select>
        </label>
        <label class="text-sm">Amount (‚Ç±)
          <input id="tx-amount" type="number" step="0.01" min="0" class="border rounded-lg px-3 py-2" required/>
        </label>
        <label class="text-sm">Balance After <input id="tx-balance-after" class="border rounded-lg px-3 py-2" placeholder="optional"/></label>
        <label class="text-sm">Linked Job/Bill <input id="tx-linked" class="border rounded-lg px-3 py-2" placeholder="optional"/></label>
        <label class="text-sm md:col-span-2">Notes <input id="tx-notes" class="border rounded-lg px-3 py-2" placeholder="optional"/></label>
        <label class="text-sm">Tags <input id="tx-tags" class="border rounded-lg px-3 py-2" placeholder="e.g., food, rent"/></label>
        <label class="text-sm">Status
          <select id="tx-status" class="border rounded-lg px-3 py-2">
            <option>planned</option><option selected>actual</option>
          </select>
        </label>
        <div class="md:col-span-2 flex gap-2 mt-2">
          <button id="tx-save-btn" class="btn btn-primary">Save</button>
          <button id="tx-delete-btn" type="button" class="btn">Delete</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Event Modal -->
  <div id="event-modal" class="modal">
    <div class="modal-card">
      <div class="flex items-center justify-between mb-2">
        <div class="font-semibold">Event / Reminder</div>
        <button id="event-cancel-btn" class="btn">Cancel</button>
      </div>
      <form id="event-form" class="grid gap-2">
        <label class="text-sm">Title <input id="event-title" class="border rounded-lg px-3 py-2" placeholder="e.g., Payday"/></label>
        <label class="text-sm">Date <input id="event-date" type="date" class="border rounded-lg px-3 py-2"/></label>
        <label class="text-sm">Notes <input id="event-notes" class="border rounded-lg px-3 py-2" placeholder="optional"/></label>
        <div class="flex gap-2">
          <button id="event-save-btn" class="btn btn-primary">Save</button>
          <button id="event-delete-btn" type="button" class="btn">Delete</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // --- Utilities ---
    const ‚Ç± = n => '‚Ç±'+Number(n||0).toLocaleString('en-PH', {maximumFractionDigits:2});
    const SHOW = el => el.classList.remove('hidden');
    const HIDE = el => el.classList.add('hidden');
    const uid = () => Math.random().toString(36).slice(2)+Date.now().toString(36);

    // Paw particles on click
    window.addEventListener('pointerdown', (e)=>{
      const p=document.createElement('div'); p.className='paw';
      p.innerHTML='üêæ'; p.style.left=e.clientX+'px'; p.style.top=e.clientY+'px';
      document.body.appendChild(p); setTimeout(()=>p.remove(), 900);
    });

    // Quotes
    const quotes=[
      "Small steps, big wins. You‚Äôve got this! üêæ",
      "Every peso saved is a paw closer to your goal.",
      "Track today, thank yourself tomorrow.",
      "Consistency beats intensity ‚Äî meow-tivation!"
    ];
    function setQuote(){
      const q=quotes[Math.floor(Math.random()*quotes.length)];
      document.getElementById('quote').textContent=q;
    }

    // Manila clock (12h)
    function tickClock(){
      try{
        const now=new Date();
        const optsDate={timeZone:'Asia/Manila', weekday:'short', year:'numeric', month:'short', day:'numeric'};
        const optsTime={timeZone:'Asia/Manila', hour:'numeric', minute:'2-digit', hour12:true};
        const d=new Intl.DateTimeFormat('en-PH', optsDate).format(now);
        const t=new Intl.DateTimeFormat('en-PH', optsTime).format(now);
        document.getElementById('clock').textContent=`${t} ‚Ä¢ ${d}`;
      }catch{}
      setTimeout(tickClock, 1000);
    }

    // Weather Davao (Open-Meteo)
    async function fetchWeather(){
      try{
        const r=await fetch('https://api.open-meteo.com/v1/forecast?latitude=7.1907&longitude=125.4553&current_weather=true');
        const j=await r.json(); const cw=j.current_weather;
        if(cw) document.getElementById('weather').textContent=`Davao: ${Math.round(cw.temperature)}¬∞C, ${cw.weathercode}`;
      }catch{ document.getElementById('weather').textContent='Davao Weather: offline'; }
    }

    // PH holiday (today) using Nager API
    async function fetchHoliday(){
      try{
        const now=new Date();
        const y=new Intl.DateTimeFormat('en-PH',{timeZone:'Asia/Manila', year:'numeric'}).format(now);
        const r=await fetch(`https://date.nager.at/api/v3/PublicHolidays/${y}/PH`);
        const j=await r.json();
        const iso=new Date().toISOString().slice(0,10);
        const today=j.find(h=>h.date===iso);
        document.getElementById('holiday').textContent = 'Holiday: ' + (today ? today.localName : '‚Äî');
      }catch{
        document.getElementById('holiday').textContent='Holiday: offline';
      }
    }

    // --- IndexedDB ---
    const DB_NAME='lexi_db_v1';
    let db;
    function openDB(){
      return new Promise((resolve,reject)=>{
        const req=indexedDB.open(DB_NAME, 1);
        req.onupgradeneeded=()=>{
          const d=req.result;
          const make=(name, key='id')=>{
            if(!d.objectStoreNames.contains(name)) d.createObjectStore(name, {keyPath:key});
          };
          ['transactions','jobs','bills','budgets','goals','events','workdays','state'].forEach(s=>make(s));
        };
        req.onsuccess=()=>{ db=req.result; resolve(); };
        req.onerror=()=>reject(req.error);
      });
    }
    function txStore(name, mode='readonly'){ return db.transaction(name, mode).objectStore(name); }
    function saveItem(store, item){
      return new Promise((res,rej)=>{
        txStore(store,'readwrite').put(item).onsuccess=()=>res();
      });
    }
    function delItem(store, id){ return new Promise(res=> txStore(store,'readwrite').delete(id).onsuccess=()=>res()); }
    function allItems(store){
      return new Promise((res)=>{ const arr=[]; txStore(store).openCursor().onsuccess=e=>{ const c=e.target.result; if(c){ arr.push(c.value); c.continue(); } else res(arr); }; });
    }
    async function restoreSnapshot(snap){
      const names=['transactions','jobs','bills','budgets','goals','events','workdays','state'];
      for(const n of names){
        const t=txStore(n,'readwrite');
        await new Promise(r=> t.clear().onsuccess=r);
        const arr=Array.isArray(snap[n])?snap[n]:[];
        for(const it of arr){ await new Promise(r=> t.put(it).onsuccess=r); }
      }
    }

    // Runtime
    const runtime={
      aggregate:'biweekly',
      settings:{avgWorkdays:22},
      profile:{},
    };

    // BroadcastChannel for cross-tab sync
    const chan = ('BroadcastChannel' in window) ? new BroadcastChannel('lexi-sync') : null;
    chan && chan.addEventListener('message', (ev)=>{
      if(ev.data==='render'){ renderAll(); }
      if(ev.data?.type==='notify'){ notify(ev.data.text); }
    });
    function broadcast(msg){ chan && chan.postMessage(msg); }

    // Undo / Redo (snapshots of all stores)
    const historyStack=[]; const redoStack=[];
    async function snapshotAll(){
      const data={};
      for(const s of ['transactions','jobs','bills','budgets','goals','events','workdays','state']) data[s]=await allItems(s);
      return data;
    }
    async function pushHistory(){
      const snap=await snapshotAll();
      historyStack.push(snap); if(historyStack.length>100) historyStack.shift();
      redoStack.length=0; // clear
    }
    async function undo(){
      if(historyStack.length<2) return;
      const cur=historyStack.pop(); redoStack.push(cur);
      const prev=historyStack[historyStack.length-1];
      await restoreSnapshot(prev); renderAll(); broadcast('render');
    }
    async function redo(){
      if(!redoStack.length) return;
      const next=redoStack.pop();
      await restoreSnapshot(next);
      historyStack.push(next);
      renderAll(); broadcast('render');
    }

    // Notifications
    async function ensureNotify(){
      try{
        if(Notification && Notification.permission!=='granted'){ await Notification.requestPermission(); }
      }catch{}
    }
    function notify(text){
      try{
        const a=document.getElementById('chime'); a.currentTime=0; a.play().catch(()=>{});
        if(Notification && Notification.permission==='granted'){
          new Notification('üêæ Lexi', { body:text, icon:'' });
        }
      }catch{}
    }
    // 9:00 AM Manila schedule (while tab open)
    function scheduleNineAM(){
      try{
        const now=new Date();
        const mnl = new Date( new Intl.DateTimeFormat('en-US', { timeZone:'Asia/Manila', hour12:false, hour:'2-digit', minute:'2-digit' }).format(now).replace(':',' ') );
        // Simple next 9AM in local time as approximation:
        const next = new Date(); next.setHours(9,0,0,0);
        if(next < new Date()) next.setDate(next.getDate()+1);
        const ms = next - new Date();
        setTimeout(()=>{ notify('Daily reminders at 9:00 AM Manila üêæ'); scheduleNineAM(); }, Math.max(ms, 1000));
      }catch{}
    }

    // Emoji mapping
    function mapEmoji(title=''){
      const t=title.toLowerCase();
      if(/bill|due|payment/.test(t)) return 'üí∏';
      if(/salary|payday|payout/.test(t)) return 'üí∞';
      if(/birthday/.test(t)) return 'üéÇ';
      if(/meeting|interview/.test(t)) return 'üìÖ';
      if(/doctor|clinic/.test(t)) return 'üè•';
      if(/flight|travel/.test(t)) return '‚úàÔ∏è';
      if(/anniversary/.test(t)) return 'üíñ';
      return 'üêæ';
    }

    // Toast (subtle)
    function toast(msg){
      const t=document.createElement('div');
      t.className='fixed bottom-4 left-1/2 -translate-x-1/2 bg-white border border-[var(--pink-300)] rounded-full px-4 py-2 shadow';
      t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(), 2000);
    }

    // Charts
    let chartIncome, chartExpenses, chartSavings;
    let repIncome, repExpenses, repSavings;
    let savTrend, goalsProgress;
    function setupChart(canvas, label){
      const ctx=canvas.getContext('2d');
      return new Chart(ctx,{ type:'line',
        data:{ labels:[], datasets:[{ label, data:[] }] },
        options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
      });
    }
    function ensureCharts(){
      if(!chartIncome){ chartIncome=setupChart(document.getElementById('chart-income'),'Income'); }
      if(!chartExpenses){ chartExpenses=setupChart(document.getElementById('chart-expenses'),'Expenses'); }
      if(!chartSavings){ chartSavings=setupChart(document.getElementById('chart-savings'),'Savings'); }
      if(!repIncome){ repIncome=setupChart(document.getElementById('rep-income'),'Income'); }
      if(!repExpenses){ repExpenses=setupChart(document.getElementById('rep-expenses'),'Expenses'); }
      if(!repSavings){ repSavings=setupChart(document.getElementById('rep-savings'),'Savings'); }
    }

    function drawSavingsCharts(goals){
      const labels=goals.map(g=>g.name);
      const progress=goals.map(g=>Math.min(100, Math.round((Number(g.current||0)/(Number(g.target||1)))*100)));
      if(!savTrend){
        savTrend=new Chart(document.getElementById('savings-trend'),{
          type:'line', data:{labels, datasets:[{label:'Savings Trend', data:progress}]}, options:{responsive:true}
        });
      }else{
        savTrend.data.labels=labels; savTrend.data.datasets[0].data=progress; savTrend.update();
      }
      if(!goalsProgress){
        goalsProgress=new Chart(document.getElementById('goals-progress'),{
          type:'bar', data:{labels, datasets:[{label:'% to Target', data:progress}]}, options:{responsive:true}
        });
      }else{
        goalsProgress.data.labels=labels; goalsProgress.data.datasets[0].data=progress; goalsProgress.update();
      }
    }

    // Aggregation helpers: bi-weekly | monthly | yearly
    function rangeKey(dateStr, mode){
      const d=new Date(dateStr); if(Number.isNaN(d)) return 'Unknown';
      const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0'); const day=d.getDate();
      if(mode==='yearly') return String(y);
      if(mode==='biweekly') return `${y}-${m}-${(day<=15)?'H1':'H2'}`;
      return `${y}-${m}`;
    }
    function aggregateSeries(txs, mode){
      const agg={income:{}, expense:{}, savings:{}};
      for(const t of txs){
        const k=rangeKey(t.date||'', mode);
        const cat=(t.category||'').toLowerCase();
        if(!agg[cat]) continue;
        agg[cat][k]=(agg[cat][k]||0)+Number(t.amount||0);
      }
      const allKeys=new Set([...Object.keys(agg.income), ...Object.keys(agg.expense), ...Object.keys(agg.savings)]);
      const labels=[...allKeys].sort();
      return {
        labels,
        income:labels.map(k=>agg.income[k]||0),
        expense:labels.map(k=>agg.expense[k]||0),
        savings:labels.map(k=>agg.savings[k]||0),
      };
    }
    async function updateChartsAggregate(){
      const txs=await allItems('transactions');
      const s=aggregateSeries(txs, runtime.aggregate);
      if(chartIncome){ chartIncome.data.labels=s.labels; chartIncome.data.datasets[0].data=s.income; chartIncome.update(); }
      if(chartExpenses){ chartExpenses.data.labels=s.labels; chartExpenses.data.datasets[0].data=s.expense; chartExpenses.update(); }
      if(chartSavings){ chartSavings.data.labels=s.labels; chartSavings.data.datasets[0].data=s.savings; chartSavings.update(); }
      if(repIncome){ repIncome.data.labels=s.labels; repIncome.data.datasets[0].data=s.income; repIncome.update(); }
      if(repExpenses){ repExpenses.data.labels=s.labels; repExpenses.data.datasets[0].data=s.expense; repExpenses.update(); }
      if(repSavings){ repSavings.data.labels=s.labels; repSavings.data.datasets[0].data=s.savings; repSavings.update(); }
    }
    async function drawReports(){ await updateChartsAggregate(); }

    // Compute summaries and dashboard panels
    function inRange(date, a, b){ return date>=a && date<=b; }
    function curCutoffs(){
      const now=new Date(); const y=now.getFullYear(); const m=now.getMonth(); const d=now.getDate();
      let cs,ce,ps,pe;
      if(d<=15){ cs=new Date(y,m,1); ce=new Date(y,m,15); ps=new Date(y,m-1,16); pe=new Date(y,m,0); }
      else { cs=new Date(y,m,16); ce=new Date(y,m+1,0); ps=new Date(y,m,1); pe=new Date(y,m,15); }
      const iso=(dt)=>dt.toISOString().slice(0,10);
      return {cs,ce,ps,pe, csISO:[iso(cs), iso(ce)], psISO:[iso(ps), iso(pe)]};
    }
    async function computeSummaries(){
      const [txs, bills, goals]= await Promise.all([allItems('transactions'), allItems('bills'), allItems('goals')]);
      const now=new Date(); const y=now.getFullYear(); const m=String(now.getMonth()+1).padStart(2,'0');
      const monthPrefix=`${y}-${m}-`;
      const monthTx=txs.filter(t=> (t.date||'').startsWith(monthPrefix));
      const income=monthTx.filter(t=>t.category==='income').reduce((a,b)=>a+Number(b.amount||0),0);
      const expenses=monthTx.filter(t=>t.category==='expense').reduce((a,b)=>a+Number(b.amount||0),0);
      const savings=monthTx.filter(t=>t.category==='savings').reduce((a,b)=>a+Number(b.amount||0),0);
      const balance=income - expenses - savings;
      document.getElementById('mo-income').textContent=‚Ç±(income);
      document.getElementById('total-expenses').textContent=‚Ç±(expenses);
      document.getElementById('total-savings').textContent=‚Ç±(savings);
      document.getElementById('balance').textContent=‚Ç±(balance);
      document.getElementById('savings-rate').textContent = (income>0) ? Math.round((savings/income)*100)+'%' : '0%';

      // Recent transactions
      const recent=[...txs].sort((a,b)=> (b.date||'').localeCompare(a.date||'')).slice(0,5);
      document.getElementById('recent-tx').innerHTML = recent.map(t=>`<li class="flex items-center justify-between"><span>${t.date} ‚Äî ${t.description}</span><span>${‚Ç±(t.amount)}</span></li>`).join('');

      // Next bills (within 2 days)
      const today = now.getDate();
      const monthDays = new Date(y, now.getMonth()+1, 0).getDate();
      const billsSoon = bills
        .map(b=>({...b, diff: ((b.due>=today)? (b.due-today) : (monthDays - today + b.due)) }))
        .sort((a,b)=>a.diff-b.diff)
        .slice(0,5);
      document.getElementById('next-bills').innerHTML = billsSoon.map(b=>`<li class="chip ${b.diff<=2?'pulse':''}">${b.name}: ${‚Ç±(b.amount)} ‚Ä¢ due ${String(b.due).padStart(2,'0')}</li>`).join('');

      // Upcoming paychecks (bi-weekly logical dates)
      const {cs,ce,csISO,psISO}=curCutoffs();
      document.getElementById('pp-curr').textContent = `Dates: ${csISO[0]} ‚Üí ${csISO[1]} ‚Ä¢ Expected: computing‚Ä¶ ‚Ä¢ Ongoing Actual: computing‚Ä¶`;
      document.getElementById('pp-prev').textContent = `Dates: ${psISO[0]} ‚Üí ${psISO[1]} ‚Ä¢ Expected: computing‚Ä¶ ‚Ä¢ Actual: computing‚Ä¶ ‚Ä¢ Diff: --`;

      const actualCurr = txs.filter(t=>t.category==='income' && inRange(t.date, csISO[0], csISO[1])).reduce((a,b)=>a+Number(b.amount||0),0);
      const actualPrev = txs.filter(t=>t.category==='income' && inRange(t.date, psISO[0], psISO[1])).reduce((a,b)=>a+Number(b.amount||0),0);

      // Expected from goals recurring + rough paycheck from salary tab records later overwritten in computePaystubs
      document.getElementById('pp-income').textContent=‚Ç±(actualCurr);
      document.getElementById('pp-curr').textContent = `Dates: ${csISO[0]} ‚Üí ${csISO[1]} ‚Ä¢ Expected: (see Salary) ‚Ä¢ Ongoing Actual: ${‚Ç±(actualCurr)}`;
      document.getElementById('pp-prev').textContent = `Dates: ${psISO[0]} ‚Üí ${psISO[1]} ‚Ä¢ Expected: (see Salary) ‚Ä¢ Actual: ${‚Ç±(actualPrev)} ‚Ä¢ Diff: --`;

      // Upcoming paychecks list: show pay out dates for both cutoffs
      const payoutPrev = new Date(psISO[1]); // previous cutoff payout rule
      const payoutCurr = new Date(ce);       // current cutoff payout rule
      // 1‚Äì15 ‚Üí end of month; 16‚Äìend ‚Üí 15th next month
      function payoutForRange(s,e){
        const sd=new Date(s); const ed=new Date(e);
        if(sd.getDate()===1 && ed.getDate()===15) { // first half
          return new Date(sd.getFullYear(), sd.getMonth()+1, 0);
        } else { // second half
          return new Date(sd.getFullYear(), sd.getMonth()+1, 15);
        }
      }
      const poPrev = payoutForRange(psISO[0], psISO[1]).toISOString().slice(0,10);
      const poCurr = payoutForRange(csISO[0], csISO[1]).toISOString().slice(0,10);
      document.getElementById('upcoming-paychecks').innerHTML = [
        `<li class="chip">Previous cutoff payout: ${poPrev}</li>`,
        `<li class="chip">Current cutoff payout: ${poCurr}</li>`
      ].join('');
    }

    // Budgets render
    async function renderBudgets(){
      const rows=await allItems('budgets'); const txs=await allItems('transactions');
      const html=rows.map(r=>{
        const actual = txs.filter(t=>t.category==='expense' && (t.tags||'').toLowerCase().includes((r.category||'').toLowerCase())).reduce((a,b)=>a+Number(b.amount||0),0);
        const diff = Number(r.planned||0) - actual;
        const pct = Math.min(100, Math.round((actual/Math.max(1, r.planned||1))*100));
        return `<tr>
          <td class="p-2">${r.category}</td>
          <td class="p-2">${‚Ç±(r.planned||0)}</td>
          <td class="p-2">${‚Ç±(actual)}</td>
          <td class="p-2">${‚Ç±(diff)}</td>
          <td class="p-2">${r.paycheck||''}</td>
          <td class="p-2 text-right">
            <div class="h-2 bg-[var(--pink-100)] rounded-full overflow-hidden mb-2"><div style="width:${pct}%" class="h-full bg-[var(--pink-400)]"></div></div>
            <button class="btn" data-edit-budget="${r.id}">Edit</button>
            <button class="btn" data-del-budget="${r.id}">Delete</button>
          </td>
        </tr>`;
      }).join('');
      document.getElementById('budget-tbody').innerHTML=html||`<tr><td class="p-2 text-sm" colspan="6">No budget rows yet.</td></tr>`;
    }

    // Savings & Goals render
    async function renderSavings(){
      const rows=await allItems('goals');
      document.getElementById('goal-tbody').innerHTML = rows.map(g=>`
        <tr>
          <td class="p-2">${g.name}</td>
          <td class="p-2">${‚Ç±(g.target||0)}</td>
          <td class="p-2">${‚Ç±(g.current||0)}</td>
          <td class="p-2">${g.date||''}</td>
          <td class="p-2">${g.recurringAmt? (‚Ç±(g.recurringAmt)+' / '+(g.recurringFreq||'monthly')) : ''}</td>
          <td class="p-2 text-right">
            <button class="btn" data-edit-goal="${g.id}">Edit</button>
            <button class="btn" data-del-goal="${g.id}">Delete</button>
          </td>
        </tr>
      `).join('') || `<tr><td class="p-2 text-sm" colspan="6">No goals yet.</td></tr>`;
      drawSavingsCharts(rows);
    }

    // Calendar render
    async function renderCalendar(){
      const el=document.getElementById('calendar');
      const events= await allItems('events');
      const now=new Date(); const yr=now.getFullYear(); const mo=now.getMonth();
      const first=new Date(yr,mo,1); const last=new Date(yr,mo+1,0);
      const startDow=first.getDay(); const days=last.getDate();
      const cells=[]; for(let i=0;i<startDow;i++) cells.push(''); for(let d=1; d<=days; d++) cells.push(d);
      el.innerHTML=cells.map(d=>{
        if(!d) return `<div class="p-2 min-h-[90px] bg-[var(--pink-100)] rounded-xl border"></div>`;
        const dateISO=`${yr}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const dayEvents = events.filter(e=>e.date===dateISO);
        const dueSoon = (()=>{ const dd=new Date(dateISO); const diff=(dd - now)/86400000; return diff>=0 && diff<=2; })();
        return `<div class="p-2 min-h-[110px] bg-[var(--pink-100)] rounded-xl border ${dueSoon?'pulse':''}">
          <div class="text-xs font-bold mb-1">${String(d).padStart(2,'0')}/${String(mo+1).padStart(2,'0')}/${yr}</div>
          <div class="space-y-1">${dayEvents.map(e=>`<button class="chip text-xs" data


    if(!chartSavings){ chartSavings=setupChart(document.getElementById('chart-savings'),'Savings'); }
  }

  // ===== Budgets =====
  async function renderBudgets(){
    const budgets= await allItems('budgets');
    const txs= await allItems('transactions');
    const tbody=document.getElementById('budget-tbody');
    tbody.innerHTML = budgets.map(b=>{
      const actual = txs.filter(t=>t.category===b.category).reduce((a,x)=>a+Number(x.amount||0),0);
      const diff = (Number(b.planned||0) - actual);
      const pct = b.planned ? Math.min(100, Math.round(actual/Number(b.planned)*100)) : 0;
      return `<tr>
        <td class="p-2">${b.category}</td>
        <td class="p-2">‚Ç±${Number(b.planned||0).toLocaleString()}</td>
        <td class="p-2">‚Ç±${actual.toLocaleString()}</td>
        <td class="p-2">‚Ç±${diff.toLocaleString()}</td>
        <td class="p-2"><div class="w-full bg-gray-200 rounded-xl h-2"><div class="h-2 rounded-xl bg-pink-400" style="width:${pct}%"></div></div></td>
        <td class="p-2 text-right">
          <button class="px-2 py-1 rounded-xl border text-xs" data-edit-budget="${b.id}">Edit</button>
          <button class="px-2 py-1 rounded-xl border text-xs" data-del-budget="${b.id}">Delete</button>
        </td>
      </tr>`;
    }).join('');
  }

  // ===== Savings & Goals =====
  async function renderSavings(){
    const goals= await allItems('goals');
    const txs= await allItems('transactions');
    const list=document.getElementById('savings-list');
    list.innerHTML = goals.map(g=>{
      const contrib = txs.filter(t=>t.goalId===g.id).reduce((a,x)=>a+Number(x.amount||0),0);
      const current = contrib + Number(g.current||0);
      const pct = g.target ? Math.min(100, Math.round(current/Number(g.target)*100)) : 0;
      return `<li class="bg-white border rounded-xl p-3 mb-2">
        <div class="font-bold">${g.name}</div>
        <div class="text-xs opacity-70">Target ‚Ç±${Number(g.target).toLocaleString()} by ${g.date||''}</div>
        <div class="mt-1">Saved: ‚Ç±${current.toLocaleString()} (${pct}%)</div>
        <div class="w-full bg-gray-200 rounded-xl h-2 mt-1"><div class="h-2 rounded-xl bg-green-400" style="width:${pct}%"></div></div>
        <div class="flex gap-2 mt-2">
          <button class="px-2 py-1 rounded-xl border text-xs" data-edit-goal="${g.id}">Edit</button>
          <button class="px-2 py-1 rounded-xl border text-xs" data-del-goal="${g.id}">Delete</button>
        </div>
      </li>`;
    }).join('');
  }

  // ===== Render All =====
  function renderAll(){
    ensureCharts();
    renderClock();
    renderWeather();
    renderQuote();
    renderDashboard();
    renderTransactions();
    renderJobs();
    renderBills();
    renderQuickSummary();
    renderWorkdays();
    renderCalendar();
    renderBudgets();
    renderSavings();
    renderHistory();
  }

  // ===== Clock, Weather, Quotes =====
  function renderClock(){
    setInterval(()=>{
      const now=new Date();
      document.getElementById('clock').textContent = now.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
      document.getElementById('date').textContent = now.toLocaleDateString('en-US',{weekday:'long', year:'numeric', month:'long', day:'numeric'});
    },1000);
  }

  async function renderWeather(){
    try{
      const res= await fetch("https://api.open-meteo.com/v1/forecast?latitude=7.0731&longitude=125.6128&current_weather=true");
      const j= await res.json();
      document.getElementById('weather').textContent=`${j.current_weather.temperature}¬∞C`;
    }catch{ document.getElementById('weather').textContent="--"; }
  }

  async function renderQuote(){
    try{
      const res= await fetch("https://api.quotable.io/random");
      const j= await res.json();
      document.getElementById('quote').textContent=j.content;
    }catch{ document.getElementById('quote').textContent="Stay positive üêæ"; }
  }

  // ===== Init =====
  window.addEventListener('load',()=>{
    renderAll();
    // background refresh every 5 min
    setInterval(renderAll, 300000);
  });
</script>
</body>
</html>


